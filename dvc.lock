schema: '2.0'
stages:
  preview:
    cmd: python3 src/preview.py
    deps:
    - path: data/prepared
      hash: md5
      md5: 9b0b44a5cf07a217c7c6497ef4659c2c.dir
      size: 546521724
      nfiles: 2142
    - path: src/preview.py
      hash: md5
      md5: 4ab1fc04f76ae42747836709553d8894
      size: 1772
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 384
        datamodule.seed: 42
        datamodule.split: 0.8
    outs:
    - path: data/preview
      hash: md5
      md5: 144c94aacb748bb370b59cd6d61d09ab.dir
      size: 2309265
      nfiles: 10
  train:
    cmd: python3 src/train.py
    deps:
    - path: data/prepared
      hash: md5
      md5: 9b0b44a5cf07a217c7c6497ef4659c2c.dir
      size: 546521724
      nfiles: 2142
    - path: data/preview
      hash: md5
      md5: 144c94aacb748bb370b59cd6d61d09ab.dir
      size: 2309265
      nfiles: 10
    - path: src/train.py
      hash: md5
      md5: 98e1105dbfdbf1fbcd875aa8c7f19421
      size: 3584
    params:
      params.yaml:
        datamodule:
          seed: 42
          data_root: data/prepared
          split: 0.8
          batch_size: 16
          image_size: 384
          num_workers: 2
          pin_memory: true
        train:
          seed: 42
          num_classes: 2
          trainable_backbone_layers: 3
          lr: 0.0075
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 5
          lr_sched_gamma: 0.8
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
    outs:
    - path: lightning_logs
      hash: md5
      md5: e14b81c1819cd32228e3f83a407667fe.dir
      size: 5505549304
      nfiles: 34
    - path: out/model.ckpt
      hash: md5
      md5: 323fa405a58cbbdc6bc2714e1ecadf7f
      size: 345578472
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: out/model.ckpt
      hash: md5
      md5: 323fa405a58cbbdc6bc2714e1ecadf7f
      size: 345578472
    - path: src/evaluate.py
      hash: md5
      md5: 76246872074b2fff306bc10bbbe9534b
      size: 2371
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 384
        datamodule.seed: 42
        datamodule.split: 0.8
        train:
          seed: 42
          num_classes: 2
          trainable_backbone_layers: 3
          lr: 0.0075
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 5
          lr_sched_gamma: 0.8
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
    outs:
    - path: data/evaluate
      hash: md5
      md5: 8d22304dcdaf665e6d3438735906d687.dir
      size: 2259603
      nfiles: 10
  prepare:
    cmd: python3 src/prepare.py
    deps:
    - path: data/raw/PV01.zip
      hash: md5
      md5: c4a02b4a2cc6364284bc8610f46539c8
      size: 108133319
    - path: data/raw/nyon_tiles
      hash: md5
      md5: b04583ac06f3aeae6d2c241f6a718b2b.dir
      size: 2230497346
      nfiles: 1111
    - path: data/raw/solar.zip
      hash: md5
      md5: e29f2f3bbb502669449b62b38c2b1878
      size: 33438193
    - path: src/prepare.py
      hash: md5
      md5: a235b2f81003018c141f7bf800a1d453
      size: 4498
    params:
      params.yaml:
        datamodule.data_root: data/prepared
    outs:
    - path: data/prepared
      hash: md5
      md5: 9b0b44a5cf07a217c7c6497ef4659c2c.dir
      size: 546521724
      nfiles: 2142
  detect:
    cmd: python3 src/detect_tif.py
    deps:
    - path: data/raw/nyon.tif
      hash: md5
      md5: bc7ea13eb06a246207e8fba8fec1a82b
      size: 3679034256
    - path: out/model.ckpt
      hash: md5
      md5: 323fa405a58cbbdc6bc2714e1ecadf7f
      size: 345578472
    - path: src/detect_tif.py
      hash: md5
      md5: 55b60bb2755cef959e916c19dfb523c2
      size: 7263
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.image_size: 384
        train.seed: 42
    outs:
    - path: out/nyon_solar.gpkg
      hash: md5
      md5: 21947923c7a23dae7611e8b053fe6685
      size: 311296
  export:
    cmd: python3 src/export.py
    deps:
    - path: out/model.ckpt
      hash: md5
      md5: 323fa405a58cbbdc6bc2714e1ecadf7f
      size: 345578472
    - path: src/export.py
      hash: md5
      md5: 18b281e82ca26a46359377e78afd8db0
      size: 2680
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.image_size: 384
        export.model_name: solar_model_gpu
    outs:
    - path: out/solar_model_gpu.bentomodel
      hash: md5
      md5: e271a669539bbea27f51d67305449982
      size: 159967928
