schema: '2.0'
stages:
  preview:
    cmd: python3 src/preview.py
    deps:
    - path: data/prepared
      hash: md5
      md5: 04dd6fc88c379a948dcc0f7d2b09c9a7.dir
      size: 111703891
      nfiles: 1714
    - path: src/preview.py
      hash: md5
      md5: 4ab1fc04f76ae42747836709553d8894
      size: 1772
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 256
        datamodule.seed: 42
        datamodule.split: 0.8
    outs:
    - path: data/preview
      hash: md5
      md5: e5586c29afa5a899b79193ce1c1ae6ce.dir
      size: 1153721
      nfiles: 10
  train:
    cmd: python3 src/train.py
    deps:
    - path: data/preview
      hash: md5
      md5: e5586c29afa5a899b79193ce1c1ae6ce.dir
      size: 1153721
      nfiles: 10
    - path: data/raw
      hash: md5
      md5: dfaf1dbeef7e5e297e9a25eabf51f17b.dir
      size: 3893999076
      nfiles: 6
    - path: src/train.py
      hash: md5
      md5: 63d7265cb05c48b0ecaa298845220e75
      size: 3532
    params:
      params.yaml:
        datamodule:
          seed: 42
          data_root: data/prepared
          split: 0.8
          batch_size: 16
          image_size: 256
          num_workers: 4
          pin_memory: true
        train:
          seed: 42
          num_classes: 2
          lr: 0.005
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 0.1
          lr_sched_gamma: 0.1
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
          accumulate_grad_batches:
    outs:
    - path: lightning_logs
      hash: md5
      md5: 05611ee7855b9ce980f5691ee193dd30.dir
      size: 2079050171
      nfiles: 12
    - path: out/model.ckpt
      hash: md5
      md5: 054ade9d1837d75b2d5d699913f50449
      size: 346489062
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: out/model.ckpt
      hash: md5
      md5: 054ade9d1837d75b2d5d699913f50449
      size: 346489062
    - path: src/evaluate.py
      hash: md5
      md5: f047f94aeaf0c083cab5a56305085216
      size: 2467
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 256
        datamodule.seed: 42
        datamodule.split: 0.8
        train:
          seed: 42
          num_classes: 2
          lr: 0.005
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 0.1
          lr_sched_gamma: 0.1
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
          accumulate_grad_batches:
    outs:
    - path: data/evaluate
      hash: md5
      md5: 9398017630bfa17d49084c68987b59b8.dir
      size: 1141222
      nfiles: 10
  prepare:
    cmd: python3 src/prepare.py
    deps:
    - path: data/raw
      hash: md5
      md5: dfaf1dbeef7e5e297e9a25eabf51f17b.dir
      size: 3893999076
      nfiles: 6
    - path: src/prepare.py
      hash: md5
      md5: 7dcc5b17b9ae0c9b67eb3ef2b7cc4a6d
      size: 3183
    params:
      params.yaml:
        datamodule.data_root: data/prepared
    outs:
    - path: data/prepared
      hash: md5
      md5: 04dd6fc88c379a948dcc0f7d2b09c9a7.dir
      size: 111703891
      nfiles: 1714
  detect:
    cmd: python3 src/detect_tif.py
    deps:
    - path: data/raw/nyon.tif
      hash: md5
      md5: bc7ea13eb06a246207e8fba8fec1a82b
      size: 3679034256
    - path: out/model.ckpt
      hash: md5
      md5: 054ade9d1837d75b2d5d699913f50449
      size: 346489062
    - path: src/detect_tif.py
      hash: md5
      md5: 0e53bab8b39b06d66517ca281e37cbb9
      size: 7317
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.image_size: 256
        train.num_classes: 2
        train.seed: 42
    outs:
    - path: out/nyon_solar.gpkg
      hash: md5
      md5: cd498175990e45f63b10cc8bcfce7b63
      size: 286720
