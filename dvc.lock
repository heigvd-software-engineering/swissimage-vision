schema: '2.0'
stages:
  prepare:
    cmd: python3 src/0_prepare.py
    deps:
    - path: data/raw/swissBOUNDARIES3D_1_5_LV95_LN02.gpkg
      hash: md5
      md5: f6f20f6b2a2e76e976e5bc5fb22d06a2
      size: 73265152
    - path: src/0_prepare.py
      hash: md5
      md5: 0c360e59d6219194572d25f492ffe630
      size: 1085
    params:
      params.yaml:
        prepare:
          src_bucket: swissimage-0.1m
          s3_src_vrt_path: files.vrt
          s3_dest_prepared_path: data/prepared
          commune_name: Nyon
          commune_x_ratio: 0.66
          commune_y_ratio: 0.75
          tile_size: 1024
  pre-train:
    cmd: python3 src/0_pre_train.py
    deps:
    - path: data/raw/bdappv.zip
      hash: md5
      md5: 451493b63927342d1dc54a365f136302
      size: 8185439624
    - path: src/0_pre_train.py
      hash: md5
      md5: f1b8df6e6b5ddfaff08cf8654e9f57c0
      size: 3869
    params:
      params.yaml:
        pre-train.datamodule.setup:
          seed: 42
          split: 0.8
          batch_size: 16
          image_size: 256
        pre-train.model:
          seed: 64
          num_classes: 1
          freeze_backbone: false
        pre-train.training:
          lr: 0.00025
          lr_decay_rate: 0.0005
          lr_sched_step_size: 1
          lr_sched_gamma: 0.7
          save_ckpt: false
          es_patience:
          epochs: 5
          precision: 32-true
    outs:
    - path: lightning_logs
      hash: md5
      md5: 47121084521526811c6cfb57c0889e2c.dir
      size: 653946985
      nfiles: 4
    - path: out/pretrained/metrics.json
      hash: md5
      md5: 19a50a6b0aaa676ce0768efc315cb125
      size: 258
    - path: out/pretrained/model.ckpt
      hash: md5
      md5: e1216ae2db90c0b14836ddfb27841616
      size: 485571270
  preprocess:
    cmd: python3 src/1_preprocess.py
    deps:
    - path: src/1_preprocess.py
      hash: md5
      md5: aa699e9faef007f37a7aac0129c4f4ff
      size: 2312
    outs:
    - path: data/preprocessed/annotations.json
      hash: md5
      md5: 8a76227e024c4e6d7ffc0fd630c8d332
      size: 10515
