schema: '2.0'
stages:
  preview:
    cmd: python3 src/preview.py
    deps:
    - path: data/prepared
      hash: md5
      md5: cdfd04e2d6dbef4b4236aa4ea8ee2201.dir
      size: 317289648
      nfiles: 1914
    - path: src/preview.py
      hash: md5
      md5: 4ab1fc04f76ae42747836709553d8894
      size: 1772
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 256
        datamodule.seed: 42
        datamodule.split: 0.8
    outs:
    - path: data/preview
      hash: md5
      md5: 8151e06be17fa2b44aeee5b5c0236986.dir
      size: 1199481
      nfiles: 10
  train:
    cmd: python3 src/train.py
    deps:
    - path: data/prepared
      hash: md5
      md5: cdfd04e2d6dbef4b4236aa4ea8ee2201.dir
      size: 317289648
      nfiles: 1914
    - path: data/preview
      hash: md5
      md5: 8151e06be17fa2b44aeee5b5c0236986.dir
      size: 1199481
      nfiles: 10
    - path: src/train.py
      hash: md5
      md5: 63d7265cb05c48b0ecaa298845220e75
      size: 3532
    params:
      params.yaml:
        datamodule:
          seed: 42
          data_root: data/prepared
          split: 0.8
          batch_size: 16
          image_size: 256
          num_workers: 4
          pin_memory: true
        train:
          seed: 42
          num_classes: 2
          lr: 0.005
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 0.1
          lr_sched_gamma: 0.1
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
          accumulate_grad_batches:
    outs:
    - path: lightning_logs
      hash: md5
      md5: 883c734bf0c08324e022aafddf5d35ad.dir
      size: 693003568
      nfiles: 4
    - path: out/model.ckpt
      hash: md5
      md5: 133d570dc77c8242872ad3f7fd3965b8
      size: 346489062
  evaluate:
    cmd: python3 src/evaluate.py
    deps:
    - path: out/model.ckpt
      hash: md5
      md5: 133d570dc77c8242872ad3f7fd3965b8
      size: 346489062
    - path: src/evaluate.py
      hash: md5
      md5: f047f94aeaf0c083cab5a56305085216
      size: 2467
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.data_root: data/prepared
        datamodule.image_size: 256
        datamodule.seed: 42
        datamodule.split: 0.8
        train:
          seed: 42
          num_classes: 2
          lr: 0.005
          lr_momentum: 0.9
          lr_decay_rate: 0.0005
          lr_sched_step_size: 0.1
          lr_sched_gamma: 0.1
          save_ckpt: false
          es_patience:
          epochs: 15
          precision: 16-mixed
          accumulate_grad_batches:
    outs:
    - path: data/evaluate
      hash: md5
      md5: 3a6815e3e1ddf751b94617f998559aa9.dir
      size: 1149876
      nfiles: 10
  prepare:
    cmd: python3 src/prepare.py
    deps:
    - path: data/raw/PV01.zip
      hash: md5
      md5: c4a02b4a2cc6364284bc8610f46539c8
      size: 108133319
    - path: data/raw/nyon_tiles
      hash: md5
      md5: 452c76214071d941c674f5c9c9089e93.dir
      size: 2230429501
      nfiles: 1111
    - path: data/raw/solar.zip
      hash: md5
      md5: e29f2f3bbb502669449b62b38c2b1878
      size: 33438193
    - path: src/prepare.py
      hash: md5
      md5: a235b2f81003018c141f7bf800a1d453
      size: 4498
    params:
      params.yaml:
        datamodule.data_root: data/prepared
    outs:
    - path: data/prepared
      hash: md5
      md5: cdfd04e2d6dbef4b4236aa4ea8ee2201.dir
      size: 317289648
      nfiles: 1914
  detect:
    cmd: python3 src/detect_tif.py
    deps:
    - path: data/raw/nyon.tif
      hash: md5
      md5: bc7ea13eb06a246207e8fba8fec1a82b
      size: 3679034256
    - path: out/model.ckpt
      hash: md5
      md5: 133d570dc77c8242872ad3f7fd3965b8
      size: 346489062
    - path: src/detect_tif.py
      hash: md5
      md5: aeb4304c82f12483e7f1935153d15dae
      size: 7318
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.image_size: 256
        train.num_classes: 2
        train.seed: 42
    outs:
    - path: out/nyon_solar.gpkg
      hash: md5
      md5: b47c82d21d13320d6125ff079d61548f
      size: 221184
  export:
    cmd: python3 src/export.py
    deps:
    - path: out/model.ckpt
      hash: md5
      md5: 133d570dc77c8242872ad3f7fd3965b8
      size: 346489062
    - path: src/export.py
      hash: md5
      md5: 7017958e6a63e84cfe8126edad7b6674
      size: 2807
    params:
      params.yaml:
        datamodule.batch_size: 16
        datamodule.image_size: 256
        export.model_name: solar_model_gpu
        train.num_classes: 2
    outs:
    - path: out/solar_model_gpu.bentomodel
      hash: md5
      md5: f20bbb0ef619ed684e54e1151b4ab4d9
      size: 159971380
